<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contacto | Chxrly</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="site-bg">
  <header class="site-header">
    <div class="container header-grid">
      <a class="brand" href="index.html">Chxrly</a>
      <button class="nav-toggle" aria-label="Abrir menú" aria-expanded="false">☰</button>
      <nav class="site-nav" id="site-nav">
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="proyectos.html">Proyectos</a></li>
          <li><a href="contacto.html" class="active">Contacto</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="container">
      <header class="section-header">
        <h1>Contacto</h1>
        <p class="text-muted">Completa el formulario. Los mensajes se guardan localmente y se muestran abajo.</p>
      </header>

      <div class="contact-grid">
        <form id="contactForm" class="contact-card" novalidate>
          <div class="form-grid">
            <div>
              <label for="name">Nombre</label>
              <input id="name" type="text" required>
            </div>
            <div>
              <label for="email">Correo</label>
              <input id="email" type="email" required>
            </div>
            <div>
              <label for="subject">Asunto</label>
              <input id="subject" type="text" required>
            </div>
            <div class="full">
              <label for="message">Mensaje</label>
              <textarea id="message" rows="4" required></textarea>
            </div>
            <div class="full actions">
              <label class="checkbox"><input id="terms" type="checkbox" required> Acepto términos</label>
              <div class="btns">
                <button type="submit" class="btn btn-primary">Enviar</button>
                <button type="reset" class="btn btn-outline">Reset</button>
              </div>
            </div>
          </div>
        </form>

        <section id="messagesList" class="messages-list" aria-live="polite">
          <!-- Mensajes renderizados aquí -->
        </section>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-grid">
      <div class="copyright">&copy; <span id="year3"></span> Chxrly</div>
    </div>
  </footer>

  <script>
    document.getElementById('year3').textContent = new Date().getFullYear();

    (function(){
      const key = 'chxrly_messages_v1';
      const form = document.getElementById('contactForm');
      const list = document.getElementById('messagesList');

      function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

      function render(){
        const arr = JSON.parse(localStorage.getItem(key) || '[]');
        list.innerHTML = '';
        if(!arr.length){ list.innerHTML = '<div class="text-muted">No hay mensajes aún.</div>'; return; }
        arr.forEach(m => {
          const card = document.createElement('article');
          card.className = 'message-card';
          card.innerHTML = `
            <h4>${escapeHtml(m.name)} <small class="text-muted">${new Date(m.date).toLocaleString()}</small></h4>
            <p class="text-muted"><strong>Asunto:</strong> ${escapeHtml(m.subject)}</p>
            <p>${escapeHtml(m.message)}</p>
            <p class="text-muted small">${escapeHtml(m.email)}</p>
          `;
          list.appendChild(card);
        });
      }

      form.addEventListener('submit', function(e){
        e.preventDefault();
        if(!form.checkValidity()) { form.classList.add('invalid'); return; }
        const msg = {
          name: document.getElementById('name').value.trim(),
          email: document.getElementById('email').value.trim(),
          subject: document.getElementById('subject').value.trim(),
          message: document.getElementById('message').value.trim(),
          date: new Date().toISOString()
        };
        const arr = JSON.parse(localStorage.getItem(key) || '[]');
        arr.unshift(msg);
        localStorage.setItem(key, JSON.stringify(arr));
        form.reset();
        render();
      });

      render();
    })();

    (function(){
      const btns = document.querySelectorAll('.nav-toggle');
      btns.forEach(b => b.addEventListener('click', () => {
        document.getElementById('site-nav').classList.toggle('open');
      }));
    })();
  </script>
</body>
</html>